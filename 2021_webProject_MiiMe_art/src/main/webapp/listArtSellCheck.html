<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>미미 美;Me 작품판매선택</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<style type="text/css">
.detail, .detail2, .artForm{
	visibility: hidden;
	display: none;
}
</style>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
//header, footer include
$(document).ready(function(){
    $("#header").load("/header.html");
    $("#footer").load("/footer.html");
});
// header, footer include
$(function(){
	
	//남혜진 210328 session유지
	//210401 통합 후 js파일 위치 변경 수정
	$.getScript("loginCheck.js", function(){
		
		let arr;
		let idx;
		let totalPage;
		let artList;
		let memNo = sessionStorage.getItem("memNo");
		
		//남혜진 210320 
		//listArtSellCheck() : 로그인한 작가회원의 art_sell_check_tb의 목록을 보여주는 함수 
		function listArtSellCheck(){
			// 이전에 불려진 목록을 삭제 : 중복제거
			$("#artSellCheckList").empty();
			let data = {"memNo":memNo};
			$.ajax({url:"/listArtSellCheck.do",
				data:data, 
				success:function(data){
				arr = [];
				data = eval("("+data+")");
				arr = data.list;
				
				$.each(arr, function(index, art){
					let div = $("<div class='detailUpdate card-body'></div>").attr("idx", index);
					// 상세보기
					$(div).click(function(){
						$("#detail").empty();
						
						let div = $("<div class='card p-1 m-1'></div>");
						//let card = $("<div class='card p-1 m-1' style='width:360px'></div>");
						
						
						//alert("div 클릭");	
						idx = $(this).attr("idx");
						artList = arr[idx];
						//alert(artList.artName);
						let pic = $("<img" + " src='art_pic/"+ art.artPic +"' width=100%>");
						let name = $("<h3></h3>").html(artList.artName);
						let material = $("<p></p>").html(artList.artMaterial);
						let theme = $("<p></p>").html(artList.artTheme);
						let size = $("<p class='card-text'></p>").html(artList.artSize1 + " x " + artList.artSize2 + "cm");
						let year = $("<p></p>").html(artList.artYear);
						let tag = $("<p></p>").html("#" + artList.artTag1 + " #" + artList.artTag2 + " #" + artList.artTag3);
						let start = $("<p></p>").html("경매시작가 [" + artList.aucStart + "] 원");
						let buy = $("<p></p>").html("즉시낙찰가 [" + artList.aucBuy + "] 원");
						let exp = $("<p></p>").html("작품설명<br>" + artList.artExp);
						$(div).append(pic, name, material, theme, size, year, tag, start, buy, exp);
						//여기 수정
						//$(card2).append($(div2));
						$("#detail").append($(div));
						
						// 상세보기 했을 때, 수정 & 삭제 버튼 보이게 하기
						$(".detail").css("visibility", "visible");
						$(".detail").css("display", "inline");
						// 상세보기 누르고, 수정삭제 버튼 누르고 다시 상세보기 누를때 -> 수정 삭제버튼 지우기
						$(".detail2").css("visibility", "hidden");
						$(".detail2").css("display", "none");
						// input 태그(수정)에 원래 값 보여주기
						$("#artNo").val(artList.artNo);
						$("#artName").val(artList.artName);
						$("#artMaterial").val(artList.artMaterial);
						$("#artTheme").val(artList.artTheme);
						$("#artSize1").val(artList.artSize1);
						$("#artSize2").val(artList.artSize2);
						$("#artYear").val(artList.artYear);
						//원래사진이름을 받아서 넣기_수정하기 위해서
						$(".artPic").val(artList.artPic);
						$("#artPic").attr("src", "art_pic/" + artList.artPic);
						$("#artExp").val(artList.artExp);
						$("#artTag1").val(artList.artTag1);
						$("#artTag2").val(artList.artTag2);
						$("#artTag3").val(artList.artTag3);
						$("#aucStart").val(artList.aucStart);
						$("#aucBuy").val(artList.aucBuy);
						
					})
					
					// 작품 목록 간단하게 보여주기 _ 선택하면 상세보기 가능
					let pic = $("<img" + " src='art_pic/"+ art.artPic +"' width=100% class='card_img_top m-1'>");
					let name = $("<h3 class='card-title'></h3>").html(art.artName);
					let material = $("<p class='card-text'></p>").html(art.artMaterial);
					let year = $("<p class='card-text'></p>").html(art.artYear);
					$(div).append(pic,name, material, year);
					//남혜진 _ 210331 _ BootStrap 적용
					let card = $("<div class='card p-1 m-1' style='width:360px'></div>");
					
					$(div).appendTo($(card));
					$("#artSellCheckList").append($(card));
				})
				
			}})
		}
		
		//남혜진 210321
		//상품수정을 위한 버튼 css처리
		$("#btnUdateAndDelete").click(function(){
			$(".artForm").css("visibility", "visible");
			$(".artForm").css("display", "inline");
			$(".detail").css("visibility", "hidden");
			$(".detail").css("display", "none");
			$(".detailUpdate").css("visibility", "hidden");
			$(".detailUpdate").css("display", "none");
			$(".detail2").css("visibility", "visible");
			$(".detail2").css("display", "inline");
		})
		
		//남혜진 210320 상품 수정 이벤트
		//상품수정 이벤트 처리
		$("#btnUpdate").click(function(){
			$("#memNo").val(memNo);
			$("#artNo").val(artList.artNo);
			let data = new FormData(document.getElementById("artForm"));
			alert("수정버튼클릭");
			$.ajax({url:"/updateArtInfo.do", 
				data:data, 
				type:"post",
				processData:false,
				contentType:false, 
				success:function(data){
					listArtSellCheck();
					$(".detail2").css("visibility", "hidden");
					$(".detail2").css("display", "none");
					
					$(".detail").css("visibility", "hidden");
					$(".detail").css("display", "none");
					$(".detailUpdate").css("visibility", "visible");
					$(".detailUpdate").css("display", "inline");
	/* 				//ajax통신 후에 변경할 이미지를 부르기 위해 지연시간을 추가
					//setTimeout 함수를 사용
	 				setTimeout(function(){
						console.log("변경할이미지: " + arr[idx].artPic);
						$("#artPic").attr("src", "art_pic/" + arr[idx].artPic);
					},500);  */
			}})
		})
		
		//남혜진 210320
		//해당작품 판매 시작하기
		$("#btnArtSell").click(function(){
			let artNo = artList.artNo;
			let data = {artNo:artNo, memNo:memNo};
			console.log("작품판매data: " + data.memNo);
			console.log("작품판매data: " + data.artNo);
	 		if(confirm(artList.artName + "작품을 판매하시겠습니까?")){
				$.ajax({url:"/startArtSell.do", data:data, success:function(){
					alert("판매성공");			
					$("#detail").css("visibility", "hidden");
					$("#detail").css("display", "none");
					listArtSellCheck();
				}})
			} 
		})
		
		//남혜진 210320
		//해당작품 정보 삭제하기
		$("#btnDelete").click(function(){
			let artNo = artList.artNo;
			let data = {artNo:artNo, memNo:memNo};
	 		if(confirm(artList.artName + "작품을 삭제하시겠습니까?")){
				$.ajax({url:"/deleteArtInfo.do", data:data, success:function(){
					alert("삭제성공");
					$("#detail").css("visibility", "hidden");
					$("#detail").css("display", "none");
					listArtSellCheck();
				}})
			} 
		})
		
		listArtSellCheck();
		
		
	})//getScript
})
</script>
</head>
<body>
 <header id="header"></header>

<div class="container">
<h2>판매가능한 작품 목록입니다</h2>
	<div id="artSellCheckList" class="row m-0 detailUpdate">
	<!-- 이곳에 작품 목록이 생성된다 -->
	</div>
</div>
<div id="page"></div>

<div class="container">
	<div id="detail" class="row m-0"><!-- 작품목록 중 해당작품선택시 상세보기 --></div>
	<button id="btnUdateAndDelete" class="detail btn btn-dark">작품 수정하기</button>
	<button id="btnArtSell" class="detail artSell btn btn-dark">해당 작품 판매시작하기</button>
	<button id="btnDelete" class="detail artDelete btn btn-dark">해당 작품정보 삭제하기</button>
<hr>
	<form class="artForm detail2 was-validated" id="artForm" method="post" enctype="multipart/form-data">
		<h5>작품 수정사항을 작성해주세요</h5>
		<!-- @@로그인 기능 구현후 memNo의 value 수정 -->
		<input type="hidden" id="memNo" name="memNo"><br>
		<input type="hidden" id="artNo" name="artNo"><br>
		<div class="form-group">
			<label for="artName">작품명 :</label>
			<input type="text" id="artName" class="form-control" name="artName" placeholder="자유형식으로 작성합니다." required>
			<div class="valid-feedback">올바른 입력입니다.</div>
      		<div class="invalid-feedback">작품명을 입력해주세요</div>
		</div>
		<div class="form-group">
			<label for="artMaterial">재료 :</label>
			<input type="text" class="form-control" id="artMaterial" name="artMaterial" placeholder="예: oil on canvas" required>
			<div class="valid-feedback">올바른 입력입니다.</div>
      		<div class="invalid-feedback">재료형식에 맞게 영문으로 입력해주세요.</div>
		</div>
		<div class="container mt-3">
			형식 : 
			<select id="artTheme" name="artTheme" class="custom-select mb-3">
				<option>인물</option>
				<option>정물</option>
				<option>동물</option>
				<option>풍경</option>
				<option>추상</option>
			</select>
		</div>
		<br>
		<div class="form-group">
			<label for="artSize">크기 :</label>
			<input type="text" id="artSize1" class="form-control" name="artSize1" placeholder="세로x가로 형식으로 작성" required>
			<div class="valid-feedback">x</div>
      		<div class="invalid-feedback">작품의 세로 크기를 cm단위의 정수로 입력해 주세요.</div>
			<input type="text" id="artSize2" name="artSize2"  class="form-control" placeholder="세로x가로 형식으로 작성" required>
			<div class="valid-feedback">cm</div>
      		<div class="invalid-feedback">작품의 가로 크기를 cm단위의 정수로 입력해 주세요.</div>
		</div>
		<div class="form-group">
			<label for="artYear">년도 :</label> 
			<input type="text" id="artYear" class="form-control" name="artYear" placeholder="숫자로 입력 (예: 2021)" required>
			<div class="valid-feedback">올바른입력입니다</div>
      		<div class="invalid-feedback">작품제작완료 년도를 정수로 입력해 주세요.</div>
		</div>
		
		<input type="hidden" name="artPic" class="artPic">
		
		<div class="container mt-3">
			<p>사진 : </p>
			<div class="custom-file mb-3">
				<input type="file" id="uploadFile" name="uploadFile"  class="custom-file-input"><br>
				<label class="custom-file-label" for="customFile">사진을 선택해주세요</label>
			</div>
		</div>
		
		<div class="form-group">
			<label for="artExp">작품설명</label><br>
			<textarea  class="form-control" rows="5" id="artExp" name="artExp" placeholder="작품에 대한 설명을 자유롭게 기입합니다."></textarea>
		</div>
		
		<div class="container mt-3">
			# 해시태그 설정하기<br>
			해시태그는 선택사항입니다
			<select id="artTag1" name="artTag1" class="custom-select mb-3">
				<option>선택안함</option>
				<option>인테리어</option>
				<option>선물</option>
			</select>
			<select id="artTag2" name="artTag2" class="custom-select mb-3">
				<option>선택안함</option>
				<option>순수미술</option>
				<option>일러스트</option>
				<option>사진</option>
			</select>
			<select id="artTag3" name="artTag3" class="custom-select mb-3">
				<option>선택안함</option>
				<option>서양화</option>
				<option>동양화</option>
				<option>판화</option>
				<option>펜화</option>
				<option>수채화</option>
				<option>포스터</option>
				<option>분위기</option>
				<option>몽환적</option>
				<option>힐링</option>
				<option>따뜻함</option>
				<option>빈티지</option>
				<option>고전</option>
				<option>현대</option>
			</select>
		</div>

		<hr>
		<div class="form-group">
			<label for="aucStart">경매시작가격 : </label>
			<input type="number" id="aucStart" name="aucStart" placeholder="숫자만 입력합니다" required>원<br>
			<div class="valid-feedback">올바른입력입니다</div>
      		<div class="invalid-feedback">경매시작 가격을 정수로 입력해 주세요.</div>
		</div>
		<div class="form-group">
			<label for="aucBuy">경매종료가격 : </label>
			<input type="number" id="aucBuy" name="aucBuy" placeholder="숫자만 입력합니다" required>원<br>
			<div class="valid-feedback">올바른입력입니다</div>
      		<div class="invalid-feedback">정수만 입력해 주세요. 경매시작 가격보다 높아야 합니다.</div>
		</div>
		경매시작가격 : <input type="number" id="aucStart" name="aucStart" placeholder="숫자만입력합니다">원<br>
		경매종료가격 : <input type="number" id="aucBuy" name="aucBuy" placeholder="숫자만입력합니다">원<br>
	</form>
	<button id="btnUpdate" class="detail2 btn btn-dark">수정</button>
</div><!-- CSS : class = container -->
 <footer id="footer"></footer>
</body>
</html>