<!DOCTYPE html>
<html>

<head>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
	<meta charset="UTF-8">
	<title>실시간 리뷰</title>

	<style>

		img{
			margin-left:auto;
			margin-right: auto;
			width: 400px;
			height: 400px;
		}
	</style>

	<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script type="text/javascript">

		$(document).ready(function () {
			$("#header").load("/header.html");
			$("#footer").load("/footer.html");
		});
		// header, footer include

		//1. 페이지 구성 (html to DOM)
		//2. js를 읽어서 순서대로 작동시킨다
		//3. document.ready 작동
		//4. window.onLoad 작동
		//5. DOM을 눈으로 볼 수 있게 바꿔준다 

		$(function () { //즉시 실행 함수 (2번 과정), 익명 함수(잠깐 사용하고 바로 사라짐)

			loadDefaultList();
			readDefaultReviewMostLike3();

		});

		let clickCnt = 1;

		function clickAddAction() {
			clickCnt += 1;
			console.log(clickCnt)
			$("#reviewList").empty(); // 목록이 중첩되지않게 초기화
			loadDefaultList();
		}

		function loadDefaultList() {
			$.ajax({
				type: "GET", //GET 타입
				url: "/detailRealTimeReviewProto.do", //URL 선언
				dataType: "JSON", ////*****************형변환 

				success: function (data) { //성공시 매개변수로 DATA를 받음

					let output = '';
					//오브젝트는 each 반복 안되니까 일반 for문 사용 
					if (clickCnt * 9 > data.list.length) {
						for (var i = 0; i < data.list.length; i++) {
							output += '<div class="col">'
							output += '<div class="card shadow-sm">';
							output += '<svg class="bd-placeholder-img card-img-top" width="100px" height="100px" role="img"><img src="img/' + data.list[i].REVIEW_IMAGE + '"/></svg>'
							output += '<div class="card-body">';
							output += '<p class="card-text" class="mb-0" ><a href="artDetail.html?memNo=' + data.list[i].MEM_NO + '&artNo=' + data.list[i].ART_NO + '&tag='
							if (data.list[i].ART_TAG1 != null) {
								output += data.list[i].ART_TAG1
							} else {
								output += '선택안함'
							}
							output += '" class="link-dark"><font size="4em">'
								+ data.list[i].ART_NAME + '</font></a></p>'
							output += '<p class="nav justify-content-end" class="card-text"><a href="artistDetail.html?memNo=' + data.list[i].AT_MEM_NO + '">'
								+ data.list[i].ARTIST_NAME + '</a>&emsp;</p>'
							output += '<p class="card-text">' + data.list[i].REVIEW_TEXT + '</p>'
							

							output += '<p class="nav justify-content-end" class="card-text">' + data.list[i].PAY_AMOUNT + '&emsp;</p>'

						output += '<ul class="nav justify-content-end">'
						if (data.list[i].ART_TAG1 != null) {
							+'<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">' + data.list[i].ART_TAG1 + '</font></a></li>'
						}
						if (data.list[i].ART_TAG2 != null) {
							output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">'
								+ data.list[i].ART_TAG2 + '</font></a></li>'
						}
						if (data.list[i].ART_TAG3 != null) {
							output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">'
								+ data.list[i].ART_TAG3 + '</font></a></li>'
						}

						if(data.list[i].ART_TAG1 == null){
							output +='<br><br>'
						}
							output += '</ul>'
							output += '<br>'

							output += '<div class="d-flex justify-content-between align-items-center">'
							output += ' <div class="btn-group">'
							output += ' <button type="button"  onClick="clickAction(' + data.list[i].REVIEW_NO + ')" class="like" id="'
								+ data.list[i].REVIEW_NO + '" class="btn btn-outline-dark"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg></button>'

							output += ' </div>'
							output += ' <small class="text-muted"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg>' + data.list[i].REVIEW_LIKE + '</small>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
						}
						$('#buttonAdd').empty();

					} else {

						for (var i = 0; i < clickCnt * 9; i++) {
							output += '<div class="col">'
							output += '<div class="card shadow-sm">';
							output += '<svg class="bd-placeholder-img card-img-top" width="100px" height="100px" role="img"><img src="img/' + data.list[i].REVIEW_IMAGE + '"/></svg>'
							output += '<div class="card-body">';
								output += '<p class="card-text" class="mb-0" ><a href="artDetail.html?memNo=' + data.list[i].MEM_NO + '&artNo=' + data.list[i].ART_NO + '&tag='
							if (data.list[i].ART_TAG1 != null) {
								output += data.list[i].ART_TAG1
							} else {
								output += '선택안함'
							}
							output += '" class="link-dark"><font size="4em">'
								+ data.list[i].ART_NAME + '</font></a></p>'
								console.log(data.list[i].ART_NO)
							output += '<p class="nav justify-content-end" class="card-text"><a href="artistDetail.html?memNo=' + data.list[i].AT_MEM_NO + '">'
								+ data.list[i].ARTIST_NAME + '</a>&emsp;</p>'
							output += '<p class="card-text">' + data.list[i].REVIEW_TEXT + '</p>'


							output += '<p class="nav justify-content-end" class="card-text">' + data.list[i].PAY_AMOUNT + '&emsp;</p>'

						output += '<ul class="nav justify-content-end">'
						if (data.list[i].ART_TAG1 != null) {
							+'<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">' + data.list[i].ART_TAG1 + '</font></a></li>'
						}
						if (data.list[i].ART_TAG2 != null) {
							output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">'
								+ data.list[i].ART_TAG2 + '</font></a></li>'
						}
						if (data.list[i].ART_TAG3 != null) {
							output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">'
								+ data.list[i].ART_TAG3 + '</font></a></li>'
						}
						if(data.list[i].ART_TAG1 == null){
							output +='<br><br>'
						}
							output += '</ul>'
							output += '<br>'

							output += '<div class="d-flex justify-content-between align-items-center">'
							output += ' <div class="btn-group">'
							output += ' <button type="button"  onClick="clickAction(' + data.list[i].REVIEW_NO + ')" class="like" id="'
								+ data.list[i].REVIEW_NO + '" class="btn btn-outline-dark"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg></button>'

							output += ' </div>'
							output += ' <small class="text-muted"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg>' + data.list[i].REVIEW_LIKE + '</small>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
						}
						let buttonAdd= '<div class="d-grid gap-2"> <button onClick="clickAddAction()" class="btn btn-primary" type="button">더보기</button></div>'
						$('#buttonAdd').append(buttonAdd);
					}
					$('#reviewList').append(output);

				}
			});
		}

		function readDefaultReviewMostLike3() {
			$("#reviewListMostLike3").empty(); // 목록이 중첩되지않게 초기화

			$.ajax({
				type: "GET", //GET 타입
				url: "/detailRealTimeReviewMost3LikeProto.do", //URL 선언
				dataType: "JSON", ////*****************형변환 

				success: function (data) { //성공시 매개변수로 DATA를 받음

					let output = '';
					//오브젝트는 each 반복 안되니까 일반 for문 사용 

					for (var i = 0; i < data.list.length; i++) {
						output += '<div class="col">'
							output += '<div class="card shadow-sm">';
							output += '<svg class="bd-placeholder-img card-img-top" width="100px" height="100px" role="img"><img src="img/' + data.list[i].REVIEW_IMAGE + '"/></svg>'
							output += '<div class="card-body">';
								output += '<p class="card-text" class="mb-0" ><a href="artDetail.html?memNo=' + data.list[i].MEM_NO + '&artNo=' + data.list[i].ART_NO + '&tag='
							if (data.list[i].ART_TAG1 != null) {
								output += data.list[i].ART_TAG1
							} else {
								output += '선택안함'
							}
							output += '" class="link-dark"><font size="4em">'
								+ data.list[i].ART_NAME + '</font></a></p>'
							output += '<p class="nav justify-content-end" class="card-text"><a href="artistDetail.html?memNo=' + data.list[i].AT_MEM_NO + '">'
								+ data.list[i].ARTIST_NAME + '</a>&emsp;</p>'
							output += '<p class="card-text">' + data.list[i].REVIEW_TEXT + '</p>'


							output += '<p class="nav justify-content-end" class="card-text">' + data.list[i].PAY_AMOUNT + '&emsp;</p>'

						output += '<ul class="nav justify-content-end">'
						if (data.list[i].ART_TAG1 != null) {
							output +='<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">' + data.list[i].ART_TAG1 + '</font></a></li>'
						}
						if (data.list[i].ART_TAG2 != null) {
							output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">'
								+ data.list[i].ART_TAG2 + '</font></a></li>'
						}
						if (data.list[i].ART_TAG3 != null) {
							output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">'
								+ data.list[i].ART_TAG3 + '</font></a></li>'
						}
						if(data.list[i].ART_TAG1 == null){
							output +='<br><br>'
						}
							output += '</ul>'
							output += '<br>'

							output += '<div class="d-flex justify-content-between align-items-center">'
							output += ' <div class="btn-group">'
							output += ' <button type="button"  onClick="clickAction(' + data.list[i].REVIEW_NO + ')" class="like" id="'
								+ data.list[i].REVIEW_NO + '" class="btn btn-outline-dark"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg></button>'

							output += ' </div>'
							output += ' <small class="text-muted"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg>' + data.list[i].REVIEW_LIKE + '</small>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'

					}
					$('#reviewListMostLike3').append(output);
				}
			});//ajax
		}//function

		function clickAction(review_no) {
			console.log("like ready activate")
			alert("좋아요!");

			//  $('.likeButton')
			//  <img class="likeButton"/>
			$('.like').toggleClass('on'); //누르면 on이 생기고 또 다시 누르면 on이 없어짐

			if ($('.like').attr('class') == 'like on') {
				console.log(review_no)
				insertLike(review_no)
			} else { //null
				deleteLike(review_no)
			}


			function insertLike(review_no) {
				let data = { REVIEW_NO: review_no };
				console.log(data)
				$.ajax({
					type: "POST", //POST 타입
					url: "/insertLikeReviewProto.do",
					data: data,
					success: function () {
						alert("좋아요 +1");
						// window.location.reload();

					}
				})
			};

			function deleteLike(review_no) {
				let data = { REVIEW_NO: review_no };

				$.ajax({
					type: "POST", //POST 타입
					url: "/deleteLikeReviewProto.do",
					data: data,
					success: function () {
						alert("좋아요 -1");
						// window.location.reload();

					}
				})
			};

		}

	</script>
</head>

<body>
	<header id="header"></header>

	<main>
		<section class="py-5 text-center container">
			<div class="row py-lg-5">
				<div class="col-lg-6 col-md-8 mx-auto">
					<h1 class="fw-light">실시간 후기</h1>
					<p class="lead text-muted">좋아요 상위 3개의 리뷰와 실시간으로 올라오는 리뷰</p>
					<p>
						<a href="artDetail.html" class="btn btn-primary my-2">작품 목록</a>
						<a href="artistDetail.html" class="btn btn-secondary my-2">작가 목록</a>
					</p>
				</div>
			</div>
		</section>

		<div class="album py-5 bg-light">
			<div class="container">
				<h3 class="pricing-header p-3 pb-md-4 mx-auto text-center" class="display-4 fw-normal">좋아요를 많이 받았어요!</h3><br>
				<div id="reviewListMostLike3" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
				</div>
				<br>
				<h3 class="pricing-header p-3 pb-md-4 mx-auto text-center" class="display-4 fw-normal">실시간 리뷰</h3><br>
				<div id="reviewList" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
				</div><br>
				<div id="buttonAdd"></div>
			</div>
		</div>
	</main>

	<footer id="footer"></footer>

</body>

</html>