<!DOCTYPE html>
<html>

<head>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

	<meta charset="UTF-8">
	<title>美;Me - 테마별후기</title>
	<style>

	</style>
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script type="text/javascript">

		$(document).ready(function () {
			$("#header").load("/header.html");
			$("#footer").load("/footer.html");
			$("#floatingbar").load("/floatingbar1.html");
		});
		// header, footer include

		let clickCnt = 1;
		var keyword = ""; // 검색어
		var orderField = "";
		var output = '';
		var sortOutput = '';
		var themeNumber = "0";

		function clickAddAction() {
			clickCnt += 1;
			console.log(clickCnt)
			$("#reviewList" + themeNumber).empty(); // 목록이 중첩되지않게 초기화
			loadReviewList(keyword, orderField, "#reviewList" + themeNumber);
			$('html, body').animate({ scrollTop: ($(document).height()) + clickCnt * 1000 }, 1500);//버튼을 눌렀을 시 누른 지점으로 바로 가게끔 animate
		}

		function clickThemeBtn(btn) {
			$('#' + btn).toggleClass('on'); //누르면 on이 생기고 또 다시 누르면 on이 없어짐
			switch (btn) {
				case '인물': { themeNumber = '1'; break; }
				case '정물': { themeNumber = '2'; break; }
				case '동물': { themeNumber = '3'; break; }
				case '풍경': { themeNumber = '4'; break; }
				case '추상': { themeNumber = '5'; break; }
			}

			if ($('#' + btn).attr('class') == 'actionButton on') {
				$("#reviewList" + themeNumber).empty(); // 목록이 중첩되지않게 초기화
				$("#btnSort" + themeNumber).empty();
				$("#buttonAdd" + themeNumber).empty();
				keyword = btn;
				loadReviewList(keyword, "", "#reviewList" + themeNumber)
			} else {
				$("#reviewList" + themeNumber).empty();
				$("#btnSort" + themeNumber).empty();
				$("#buttonAdd" + themeNumber).empty();
			}
		}


		function clickSortAction(orderField) {
			$("#btnSort" + themeNumber).empty();
			$("#buttonAdd" + themeNumber).empty();
			$("#reviewList" + themeNumber).empty();
			loadReviewList(keyword, orderField, "#reviewList" + themeNumber);
		};

		// 모든 상품목록을 Ajax 통신으로 요청하는 함수 시작
		function loadReviewList(keyword, orderField, editList) {

			let data = { keyword: keyword, orderField: orderField };

			$.ajax({
				url: "/detailThemeReviewProto.do",
				dataType: "JSON", ////*****************형변환 
				data: data,
				success: function (data) {


					output = '';
					sortOutput = '';

					$('#btnSort' + themeNumber).empty();
					sortOutput += '<div class="container">'
					sortOutput += '<div class="d-grid gap-2 d-sm-flex justify-content-sm-center">'
					sortOutput += `<button type="button" class="btn btn-dark" onClick="clickSortAction('likeDesc')">좋아요 높은 순서</button>`
					sortOutput += `<button type="button" class="btn btn-dark" onClick="clickSortAction('priceAsc')">가격 낮은 순서</button>`
					sortOutput += `<button type="button" class="btn btn-dark" onClick="clickSortAction('priceDesc')">가격 높은 순서</button>`
					sortOutput += '</div>'
					sortOutput += '<br>'
					sortOutput += '</div>'

					$('#btnSort' + themeNumber).append(sortOutput);


					if (clickCnt * 9 > data.list.length) {
						for (var i = 0; i < data.list.length; i++) {
							output += '<div class="col">'
							output += '<div class="card shadow-sm">';
							output += '<svg class="bd-placeholder-img card-img-top" width="100px" height="100px" role="img"><img src="img/' + data.list[i].reviewImage + '"/></svg>'
							output += '<div class="card-body">';
							output += '<p class="card-text" class="mb-0" ><a style="text-decoration: none; color: black;" href="artDetail.html?memNo=' + data.list[i].memNo + '&artNo=' + data.list[i].artNo + '&tag='
							if (data.list[i].artTag1 != null) {
								output += data.list[i].artTag1
							} else {
								output += '선택안함'
							}
							output += '" class="link-dark"><font size="4em">'
								+ data.list[i].artName + '</font></a></p>'
							output += '<p class="nav justify-content" class="card-text">' + data.list[i].payAmount.toLocaleString(); + '&emsp;</p>'
							output += '<p class="nav justify-content-end" class="card-text"><a style="text-decoration: none; color: black;" href="artistDetail.html?memNo=' + data.list[i].atMemNo + '">'
								+ data.list[i].artistName + '</a>&emsp;</p>'
							output += '<br><br>'

							output += '<p class="card-text">' + data.list[i].reviewText + '</p>'



							output += '<ul class="nav justify-content-end">'
							if (data.list[i].artTag1 != null) {
								+'<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">#' + data.list[i].artTag1 + '</font></a></li>'
							}
							if (data.list[i].artTag2 != null) {
								output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">#'
									+ data.list[i].artTag2 + '</font></a></li>'
							}
							if (data.list[i].artTag3 != null) {
								output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">#'
									+ data.list[i].artTag3 + '</font></a></li>'
							}

							if (data.list[i].artTag1 == null) {
								output += '<br><br>'
							}
							output += '</ul>'
							output += '<br>'

							output += '<div class="d-flex justify-content-between align-items-center">'
							output += ' <div class="btn-group">'
							output += ' <button type="button" style="background-color:white; border-radius: 7px;" onClick="clickAction(' + data.list[i].reviewNo + ')" class="like' + data.list[i].reviewNo + '" id="'
								+ data.list[i].reviewNo + '"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg></button>'
							output += ' </div>'
							output += ' <small class="text-muted"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg>' + data.list[i].reviewLike + '</small>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
						}
						$('#buttonAdd' + themeNumber).empty();

					} else {
						for (var i = 0; i < clickCnt * 9; i++) {
							output += '<div class="col">'
							output += '<div class="card shadow-sm">';
							output += '<svg class="bd-placeholder-img card-img-top" width="100px" height="100px" role="img"><img src="img/' + data.list[i].reviewImage + '"/></svg>'
							output += '<div class="card-body">';
							output += '<p class="card-text" class="mb-0" ><a style="text-decoration: none; color: black;" href="artDetail.html?memNo=' + data.list[i].memNo + '&artNo=' + data.list[i].artNo + '&tag='
							if (data.list[i].artTag1 != null) {
								output += data.list[i].artTag1
							} else {
								output += '선택안함'
							}
							output += '" class="link-dark"><font size="4em">'
								+ data.list[i].artName + '</font></a></p>'
							output += '<p class="nav justify-content" class="card-text">' + data.list[i].payAmount.toLocaleString(); + '&emsp;</p>'
							output += '<p class="nav justify-content-end" class="card-text"><a style="text-decoration: none; color: black;" href="artistDetail.html?memNo=' + data.list[i].atMemNo + '">'
								+ data.list[i].artistName + '</a>&emsp;</p>'
							output += '<br><br>'

							output += '<p class="card-text">' + data.list[i].reviewText + '</p>'



							output += '<ul class="nav justify-content-end">'
							if (data.list[i].artTag1 != null) {
								+'<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">#' + data.list[i].artTag1 + '</font></a></li>'
							}
							if (data.list[i].artTag2 != null) {
								output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">#'
									+ data.list[i].artTag2 + '</font></a></li>'
							}
							if (data.list[i].artTag3 != null) {
								output += '<li class="nav-item"><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"><font size="2em">#'
									+ data.list[i].artTag3 + '</font></a></li>'
							}

							if (data.list[i].artTag1 == null) {
								output += '<br><br>'
							}
							output += '</ul>'
							output += '<br>'

							output += '<div class="d-flex justify-content-between align-items-center">'
							output += ' <div class="btn-group">'
							output += ' <button type="button" style="background-color:white; border-radius: 7px;" onClick="clickAction(' + data.list[i].reviewNo + ')" class="like' + data.list[i].reviewNo + '" id="'
								+ data.list[i].reviewNo + '"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg></button>'
							output += ' </div>'
							output += ' <small class="text-muted"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg>' + data.list[i].reviewLike + '</small>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
							output += ' </div>'
						}
						let buttonAdd = '<div class="d-grid gap-2"> <button onClick="clickAddAction()" class="btn btn-dark" type="button">더보기</button></div>'
						$('#buttonAdd' + themeNumber).append(buttonAdd);
					}
					$(editList).append(output);
				}//data	(success)
			});//ajax
		}//loadReviewList 끝



		function clickAction(reviewNo) {
			$('.like' + reviewNo).toggleClass('on'); //누르면 on이 생기고 또 다시 누르면 on이 없어짐
			if ($('.like' + reviewNo).attr('class') == 'like' + reviewNo + ' on') {
				insertLike(reviewNo)
			} else { //null
				deleteLike(reviewNo)
			}
		}


		function insertLike(reviewNo) {
			let data = { reviewNo: reviewNo };
			console.log(data)
			$.ajax({
				type: "POST", //POST 타입
				url: "/insertLikeReviewProto.do",
				data: data,
				success: function () {
					alert("좋아요 +1");
				}
			})
		};

		function deleteLike(reviewNo) {
			let data = { reviewNo: reviewNo };

			$.ajax({
				type: "POST", //POST 타입
				url: "/deleteLikeReviewProto.do",
				data: data,
				success: function () {
					alert("좋아요 -1");
				}
			})
		};



	</script>
</head>

<body>
	<header id="header"></header>

	<main>
		<section class="py-5 text-center container">
			<div class="row py-lg-5">
				<div class="col-lg-6 col-md-8 mx-auto">
					<h1 class="fw-light">테마로 후기 모아보기</h1>
					<p class="lead text-muted">작가가 pick한 테마로 후기 모아보기</p>
					<p>
						<a href="artList.html" class="btn btn-dark">작품 목록</a>
						<a href="artistList.html" class="btn btn-secondary my-2">작가 목록</a>
					</p>
				</div>
			</div>
		</section>


		<div class="accordion" id="accordionExample">
			<div class="container">
				<div class="accordion-item">
					<h2 class="accordion-header" id="flush-headingOne">
						<div class="actionButton" id="인물" onClick="clickThemeBtn('인물')">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
								data-bs-target="#flush-collapseOne" aria-expanded="false"
								aria-controls="flush-collapseOne">
								인물</button>
						</div>
					</h2>
					<div class="accordion-body">
						<div id="btnSort1"></div>
						<div id="reviewList1" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"></div>
						<div id="buttonAdd1"></div>
					</div>
				</div>

				<div class="accordion-item">
					<h2 class="accordion-header" id="flush-headingTwo">
						<div class="actionButton" id="정물" onClick="clickThemeBtn('정물')">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
								data-bs-target="#flush-collapseOne" aria-expanded="false"
								aria-controls="flush-collapseOne">
								정물</button>
						</div>
					</h2>
					<div class="accordion-body">
						<div id="btnSort2"></div>
						<div id="reviewList2" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"></div>
						<div id="buttonAdd2"></div>
					</div>
				</div>


				<div class="accordion-item">
					<h2 class="accordion-header" id="flush-headingThree">
						<div class="actionButton" id="동물" onClick="clickThemeBtn('동물')">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
								data-bs-target="#flush-collapseOne" aria-expanded="false"
								aria-controls="flush-collapseOne">
								동물</button>
						</div>
					</h2>
					<div class="accordion-body">
						<div id="btnSort3"></div>
						<div id="reviewList3" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"></div>
						<div id="buttonAdd3"></div>
					</div>
				</div>


				<div class="accordion-item">
					<h2 class="accordion-header" id="flush-headingFour">
						<div class="actionButton" id="풍경" onClick="clickThemeBtn('풍경')">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
								data-bs-target="#flush-collapseOne" aria-expanded="false"
								aria-controls="flush-collapseOne">
								풍경</button>
						</div>
					</h2>
					<div class="accordion-body">
						<div id="btnSort4"></div>
						<div id="reviewList4" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"></div>
						<div id="buttonAdd4"></div>
					</div>
				</div>


				<div class="accordion-item">
					<h2 class="accordion-header" id="flush-headingFive">
						<div class="actionButton" id="추상" onClick="clickThemeBtn('추상')">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
								data-bs-target="#flush-collapseOne" aria-expanded="false"
								aria-controls="flush-collapseOne">
								추상</button>
						</div>
					</h2>
					<div class="accordion-body">
						<div id="btnSort5"></div>
						<div id="reviewList5" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"></div>
						<div id="buttonAdd5"></div>
					</div>
				</div>
			</div>
		</div>

	</main>

	<div id="floatingbar"></div>
	<footer id="footer"></footer>


</body>

</html>